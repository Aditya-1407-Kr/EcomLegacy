<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>EcomLegacy Admin Panel</title>
<link rel="icon" type="image/svg+xml" href="logo.svg"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#13c8ec",
                    "background-light": "#f6f8f8",
                    "background-dark": "#101f22",
                },
                fontFamily: {
                    "display": ["Plus Jakarta Sans", "sans-serif"]
                },
                borderRadius: {
                    "DEFAULT": "0.5rem",
                    "lg": "1rem",
                    "xl": "1.5rem",
                    "full": "9999px"
                },
            },
        },
    }
</script>
<style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; }
    .sidebar-active {
        background-color: rgba(19, 200, 236, 0.15);
        color: #13c8ec;
        border-right: 4px solid #13c8ec;
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen">
<!-- Login Modal with Tabs -->
<div id="login-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] hidden">
  <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 max-w-md w-full shadow-2xl">
    <!-- Tab Buttons -->
    <div class="flex gap-2 mb-8 border-b border-slate-200 dark:border-slate-700">
      <button id="admin-tab-btn" onclick="switchLoginTab('admin')" class="flex-1 py-3 px-4 text-sm font-semibold border-b-2 border-primary text-primary transition-all flex items-center justify-center gap-2">
        <span class="material-symbols-outlined text-sm">admin_panel_settings</span>
        <span class="hidden sm:inline">Admin</span>
      </button>
      <button id="seller-tab-btn" onclick="switchLoginTab('seller')" class="flex-1 py-3 px-4 text-sm font-semibold border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300 transition-all flex items-center justify-center gap-2">
        <span class="material-symbols-outlined text-sm">store</span>
        <span class="hidden sm:inline">Seller</span>
      </button>
    </div>
    
    <!-- Admin Login Tab -->
    <div id="admin-login-tab" class="space-y-6">
      <div class="text-center mb-8">
        <div class="w-16 h-16 bg-primary rounded-2xl flex items-center justify-center text-white mx-auto mb-4">
          <span class="material-symbols-outlined text-3xl">admin_panel_settings</span>
        </div>
        <h2 class="text-2xl font-bold mb-2">Admin Login</h2>
        <p class="text-slate-500 dark:text-slate-400 text-sm">Enter your admin credentials</p>
      </div>
      <form id="admin-login-form" class="space-y-4">
        <div>
          <label class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2 block">Email</label>
          <input id="admin-email" class="w-full h-11 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white px-4 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all" placeholder="admin@example.com" type="email" required/>
        </div>
        <div>
          <label class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2 block">Password</label>
          <input id="admin-password" class="w-full h-11 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white px-4 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" type="password" required/>
        </div>
        <div id="admin-login-error" class="text-sm text-red-500 hidden"></div>
        <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-2.5 rounded-lg transition-all flex items-center justify-center gap-2">
          <span class="material-symbols-outlined text-sm">login</span>
          Login
        </button>
      </form>
      <p class="text-xs text-center text-slate-500 dark:text-slate-400">
        Enter your admin credentials
      </p>
    </div>
    
    <!-- Seller Login Tab -->
    <div id="seller-login-tab" class="space-y-6 hidden">
      <div class="text-center mb-8">
        <div class="w-16 h-16 bg-blue-500 rounded-2xl flex items-center justify-center text-white mx-auto mb-4">
          <span class="material-symbols-outlined text-3xl">store</span>
        </div>
        <h2 class="text-2xl font-bold mb-2">Seller Login</h2>
        <p class="text-slate-500 dark:text-slate-400 text-sm">Access your seller dashboard</p>
      </div>
      <form id="seller-login-form" class="space-y-4">
        <div>
          <label class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2 block">Email</label>
          <input id="seller-email" class="w-full h-11 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white px-4 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all" placeholder="seller@example.com" type="email" required/>
        </div>
        <div>
          <label class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2 block">Password</label>
          <input id="seller-password" class="w-full h-11 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white px-4 focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" type="password" required/>
        </div>
        <div id="seller-login-error" class="text-sm text-red-500 hidden"></div>
        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 rounded-lg transition-all flex items-center justify-center gap-2">
          <span class="material-symbols-outlined text-sm">login</span>
          Login as Seller
        </button>
      </form>
      <p class="text-xs text-center text-slate-500 dark:text-slate-400">
        Contact admin to create your seller account
      </p>
    </div>
  </div>
</div>

<!-- Main Admin Panel (Hidden until login) -->
<div id="admin-panel" class="flex h-screen overflow-hidden hidden">
<!-- Sidebar Navigation -->
<aside class="w-64 flex-shrink-0 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col">
<div class="p-6 flex items-center gap-3">
<a href="index.html" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
<img src="logo.svg" alt="EcomLegacy" class="h-10 w-10"/>
<div class="flex flex-col">
<h1 class="text-slate-900 dark:text-white font-bold text-lg leading-tight">EcomLegacy</h1>
<p class="text-slate-500 dark:text-slate-400 text-xs font-medium">Admin Central</p>
</div>
</a>
</div>
<nav class="flex-1 px-4 py-4 space-y-1">
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary font-semibold sidebar-active nav-link" href="#" data-tab="dashboard">
<span class="material-symbols-outlined text-[22px]">dashboard</span>
<span class="text-sm">Dashboard</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors nav-link" href="#" data-tab="products">
<span class="material-symbols-outlined text-[22px]">inventory_2</span>
<span class="text-sm">Products</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors nav-link" href="#" data-tab="orders">
<span class="material-symbols-outlined text-[22px]">shopping_cart</span>
<span class="text-sm">Orders</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors nav-link" href="#" data-tab="analytics">
<span class="material-symbols-outlined text-[22px]">analytics</span>
<span class="text-sm">Analytics</span>
</a>
<a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors nav-link" href="#" data-tab="sellers">
<span class="material-symbols-outlined text-[22px]">person_add</span>
<span class="text-sm">Sellers</span>
</a>
</nav>
<div class="p-4 border-t border-slate-100 dark:border-slate-800 space-y-2">
<button class="w-full flex items-center justify-center gap-2 bg-primary text-slate-900 font-bold py-2.5 rounded-lg hover:brightness-110 transition-all text-sm shadow-sm shadow-primary/20" onclick="window.location.href='marketplace.html';">
<span class="material-symbols-outlined text-sm font-bold">shopping_cart</span>
Shop
</button>
<a href="index.html" class="w-full flex items-center justify-center gap-2 bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white font-bold py-2.5 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-all text-sm block">
<span class="material-symbols-outlined text-sm font-bold">home</span>
Home
</a>
</div>
</aside>

<!-- Main Content Wrapper -->
<div class="flex-1 flex flex-col overflow-hidden">
<!-- Header -->
<header class="h-16 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-8 z-10">
<div class="flex items-center gap-6 flex-1">
<h2 class="text-lg font-bold text-slate-800 dark:text-white" id="page-title">Dashboard</h2>
</div>
<div class="flex items-center gap-4">
<button class="p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg relative">
<span class="material-symbols-outlined">notifications</span>
</button>
<button onclick="adminLogout()" class="p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg" title="Logout">
<span class="material-symbols-outlined">logout</span>
</button>
</div>
</header>

<!-- Content Area -->
<div class="flex-1 overflow-y-auto">
<!-- Dashboard Tab -->
<div id="dashboard-tab" class="tab-content p-8">
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
<div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800">
<div class="flex items-center gap-4">
<div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
<span class="material-symbols-outlined">inventory_2</span>
</div>
<div>
<p class="text-xs font-bold text-slate-500 uppercase">Total Products</p>
<p class="text-2xl font-extrabold" id="total-products">0</p>
</div>
</div>
</div>
<div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800">
<div class="flex items-center gap-4">
<div class="w-12 h-12 bg-green-500/10 rounded-lg flex items-center justify-center text-green-500">
<span class="material-symbols-outlined">trending_up</span>
</div>
<div>
<p class="text-xs font-bold text-slate-500 uppercase">Total Sales</p>
<p class="text-2xl font-extrabold" id="total-sales">0</p>
</div>
</div>
</div>
<div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800">
<div class="flex items-center gap-4">
<div class="w-12 h-12 bg-amber-500/10 rounded-lg flex items-center justify-center text-amber-500">
<span class="material-symbols-outlined">monetization_on</span>
</div>
<div>
<p class="text-xs font-bold text-slate-500 uppercase">Total Revenue</p>
<p class="text-2xl font-extrabold" id="total-revenue">$0.00</p>
</div>
</div>
</div>
<div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800">
<div class="flex items-center gap-4">
<div class="w-12 h-12 bg-blue-500/10 rounded-lg flex items-center justify-center text-blue-500">
<span class="material-symbols-outlined">pending_actions</span>
</div>
<div>
<p class="text-xs font-bold text-slate-500 uppercase">Pending Orders</p>
<p class="text-2xl font-extrabold" id="pending-orders">0</p>
</div>
</div>
</div>
</div>
</div>

<!-- Products Tab -->
<div id="products-tab" class="tab-content hidden p-8">
<div class="flex items-center justify-between mb-8">
<h2 class="text-2xl font-bold">Product Management</h2>
<button class="bg-primary hover:bg-primary/90 text-white px-6 py-2.5 rounded-lg font-bold text-sm flex items-center gap-2 transition-all shadow-sm add-product-btn">
<span class="material-symbols-outlined">add_circle</span>
Add New Product
</button>
</div>

<div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden">
<table class="w-full text-left border-collapse">
<thead>
<tr class="bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-800">
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Product</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Price</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Category</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase text-right">Actions</th>
</tr>
</thead>
<tbody class="divide-y divide-slate-100 dark:divide-slate-800" id="products-list">
<tr class="text-center py-8 text-slate-500">
<td colspan="4" class="py-8">Loading products...</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Orders Tab -->
<div id="orders-tab" class="tab-content hidden p-8">
<h2 class="text-2xl font-bold mb-8">Orders</h2>
<div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden">
<table class="w-full text-left border-collapse">
<thead>
<tr class="bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-800">
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Order ID</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Customer</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Amount</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Status</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Date</th>
<th class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">Actions</th>
</tr>
</thead>
<tbody class="divide-y divide-slate-100 dark:divide-slate-800" id="orders-list">
<tr class="text-center py-8 text-slate-500">
<td colspan="6" class="py-8">Loading orders...</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Analytics Tab -->
<div id="analytics-tab" class="tab-content hidden p-8">
<h2 class="text-2xl font-bold mb-8">Analytics</h2>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
<div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800">
<h3 class="text-lg font-bold mb-4">Top Products</h3>
<div class="space-y-3" id="top-products">
<p class="text-slate-500">Loading...</p>
</div>
</div>
<div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800">
<h3 class="text-lg font-bold mb-4">Revenue Summary</h3>
<div id="revenue-chart" class="text-slate-500 text-center py-8">
Calculating...
</div>
</div>
</div>
</div>

<!-- Sellers Tab -->
<div id="sellers-tab" class="tab-content hidden p-8">
<div class="flex items-center justify-between mb-8">
<h2 class="text-2xl font-bold">Manage Sellers</h2>
<button class="add-seller-btn bg-primary hover:bg-primary/90 text-white font-bold py-2.5 px-6 rounded-lg transition-all flex items-center gap-2">
<span class="material-symbols-outlined text-sm">person_add</span>
Add New Seller
</button>
</div>

<div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden">
<table class="w-full">
<thead class="bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700">
<tr>
<th class="px-6 py-4 text-left text-sm font-semibold">Name</th>
<th class="px-6 py-4 text-left text-sm font-semibold">Email</th>
<th class="px-6 py-4 text-left text-sm font-semibold">Status</th>
<th class="px-6 py-4 text-left text-sm font-semibold">Join Date</th>
<th class="px-6 py-4 text-left text-sm font-semibold">Actions</th>
</tr>
</thead>
<tbody id="sellers-list" class="divide-y divide-slate-200 dark:divide-slate-700">
<tr>
<td class="px-6 py-4 text-slate-500">Loading sellers...</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div> <!-- End admin-panel -->

<!-- Add Product Modal -->
<div id="add-product-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
<div class="bg-white dark:bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
<div class="sticky top-0 bg-white dark:bg-slate-800 flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
<h2 class="text-2xl font-bold">Add New Product</h2>
<button class="close-modal text-slate-400 hover:text-slate-900 dark:hover:text-white">
<span class="material-symbols-outlined text-2xl">close</span>
</button>
</div>

<form id="product-form" class="p-6 space-y-4">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-semibold mb-2">Product Name</label>
<input type="text" name="name" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="Enter product name" required/>
</div>
<div>
<label class="block text-sm font-semibold mb-2">Price (‚Çπ)</label>
<input type="number" name="price" step="0.01" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="0.00" required/>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-semibold mb-2">Category</label>
<input type="text" name="category" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="e.g., Electronics, Clothing" required/>
</div>
<div>
<label class="block text-sm font-semibold mb-2">Upload Cover Image</label>
<input type="file" name="image-upload" accept="image/*" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700"/>
<p class="text-xs text-slate-500 mt-1">PNG, JPG, or GIF (Max 5MB)</p>
<input type="hidden" name="image" id="image-data"/>
</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-semibold mb-2">Description</label>
<textarea name="description" rows="3" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="Product description..."></textarea>
</div>
<div>
<label class="block text-sm font-semibold mb-2">Product Link</label>
<input type="url" name="product-link" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="https://example.com/download" required/>
<p class="text-xs text-slate-500 mt-1">Link to redirect after purchase</p>
</div>
</div>

<div class="flex gap-3 pt-6">
<button type="submit" class="flex-1 bg-primary text-white py-2 rounded-lg font-bold hover:bg-primary/90 transition-all">
Add Product
</button>
<button type="button" class="flex-1 bg-slate-200 dark:bg-slate-700 py-2 rounded-lg font-bold close-modal">
Cancel
</button>
</div>
</form>
</div>
</div>

<!-- Add Seller Modal -->
<div id="add-seller-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
<div class="bg-white dark:bg-slate-800 rounded-2xl max-w-md w-full">
<div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
<h2 class="text-2xl font-bold">Add New Seller</h2>
<button onclick="document.getElementById('add-seller-modal').classList.add('hidden')" class="text-slate-400 hover:text-slate-900 dark:hover:text-white">
<span class="material-symbols-outlined text-2xl">close</span>
</button>
</div>

<form id="seller-form" class="p-6 space-y-4">
<div>
<label class="block text-sm font-semibold mb-2">Seller Name</label>
<input type="text" id="form-seller-name" name="form-seller-name" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="Enter seller name" autocomplete="off"/>
</div>
<div>
<label class="block text-sm font-semibold mb-2">Email</label>
<input type="email" id="form-seller-email" name="form-seller-email" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="seller@example.com" autocomplete="off"/>
</div>
<div>
<label class="block text-sm font-semibold mb-2">Password</label>
<input type="password" id="form-seller-password" name="form-seller-password" class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-primary dark:bg-slate-700" placeholder="Enter secure password" autocomplete="off"/>
</div>
<div class="flex gap-3 pt-4">
<button type="submit" class="flex-1 bg-primary text-white py-2 rounded-lg font-bold hover:bg-primary/90 transition-all">
Create Seller
</button>
<button type="button" class="flex-1 bg-slate-200 dark:bg-slate-700 py-2 rounded-lg font-bold" onclick="document.getElementById('add-seller-modal').classList.add('hidden')">
Cancel
</button>
</div>
</form>
</div>
</div>

<script src="config.js"></script>
<script src="admin.js"></script>
<script src="seller-manager.js"></script>
<script>
// Login System - Admin & Seller
document.addEventListener('DOMContentLoaded', () => {
  const loginModal = document.getElementById('login-modal');
  const adminPanel = document.getElementById('admin-panel');
  
  // Check if already logged in
  if (localStorage.getItem('adminLoggedIn') === 'true') {
    loginModal.classList.add('hidden');
    adminPanel.classList.remove('hidden');
    initializeAdmin();
  } else if (localStorage.getItem('sellerLoggedIn') === 'true') {
    // Redirect to seller dashboard
    const sellerId = localStorage.getItem('sellerId');
    const referralCode = localStorage.getItem('referralCode');
    window.location.href = `seller-dashboard.html?seller_id=${sellerId}&referral=${referralCode}`;
  } else {
    // Show login modal when not logged in
    loginModal.classList.remove('hidden');
    adminPanel.classList.add('hidden');
  }
  
  // Setup form listeners
  setupAdminLogin();
  setupSellerLogin();
});

// Tab switching between Admin and Seller
function switchLoginTab(tab) {
  const adminTab = document.getElementById('admin-login-tab');
  const sellerTab = document.getElementById('seller-login-tab');
  const adminBtn = document.getElementById('admin-tab-btn');
  const sellerBtn = document.getElementById('seller-tab-btn');
  
  if (tab === 'admin') {
    adminTab.classList.remove('hidden');
    sellerTab.classList.add('hidden');
    adminBtn.classList.add('border-primary', 'text-primary');
    adminBtn.classList.remove('border-transparent', 'text-slate-500');
    sellerBtn.classList.add('border-transparent', 'text-slate-500');
    sellerBtn.classList.remove('border-primary', 'text-primary');
  } else {
    adminTab.classList.add('hidden');
    sellerTab.classList.remove('hidden');
    sellerBtn.classList.add('border-primary', 'text-primary');
    sellerBtn.classList.remove('border-transparent', 'text-slate-500');
    adminBtn.classList.add('border-transparent', 'text-slate-500');
    adminBtn.classList.remove('border-primary', 'text-primary');
  }
}

// Admin Login Handler
function setupAdminLogin() {
  const adminForm = document.getElementById('admin-login-form');
  if (!adminForm) return;
  
  adminForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('admin-email').value.trim();
    const password = document.getElementById('admin-password').value;
    const errorDiv = document.getElementById('admin-login-error');
    
    try {
      console.log('üîê Attempting admin login with email:', email);
      
      // Fetch admin from sellers table
      const response = await fetch(
        `${SUPABASE_URL}/rest/v1/sellers?email=eq.${encodeURIComponent(email)}`,
        {
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Accept': 'application/json'
          }
        }
      );
      
      if (!response.ok) {
        throw new Error(`Failed to authenticate: ${response.status}`);
      }
      
      const admins = await response.json();
      
      if (!admins || admins.length === 0) {
        errorDiv.textContent = '‚ùå Admin account not found';
        errorDiv.classList.remove('hidden');
        console.log('‚ùå No admin found with email:', email);
        return;
      }
      
      const admin = admins[0];
      
      // Decode and verify password
      const storedPassword = atob(admin.password);
      if (storedPassword !== password) {
        errorDiv.textContent = '‚ùå Invalid password';
        errorDiv.classList.remove('hidden');
        console.log('‚ùå Password mismatch for admin:', admin.name);
        return;
      }
      
      // Check if admin is active
      if (!admin.is_active) {
        errorDiv.textContent = '‚ùå Your admin account has been deactivated';
        errorDiv.classList.remove('hidden');
        console.log('‚ùå Admin account is inactive:', admin.name);
        return;
      }
      
      // Login successful
      console.log('‚úì Admin authenticated:', admin.name);
      
      localStorage.setItem('adminLoggedIn', 'true');
      localStorage.removeItem('sellerLoggedIn');
      
      document.getElementById('login-modal').classList.add('hidden');
      document.getElementById('admin-panel').classList.remove('hidden');
      initializeAdmin();
      adminForm.reset();
      
      console.log('‚úì Admin logged in successfully');
    } catch (error) {
      console.error('‚ùå Admin login error:', error);
      errorDiv.textContent = '‚ùå Login failed: ' + error.message;
      errorDiv.classList.remove('hidden');
    }
  });
}

// Seller Login Handler
function setupSellerLogin() {
  const sellerForm = document.getElementById('seller-login-form');
  if (!sellerForm) return;
  
  sellerForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('seller-email').value.trim();
    const password = document.getElementById('seller-password').value;
    const errorDiv = document.getElementById('seller-login-error');
    
    try {
      errorDiv.classList.add('hidden');
      errorDiv.textContent = '';
      
      // Fetch seller data from Supabase
      console.log('üîç Searching for seller with email:', email);
      
      const response = await fetch(
        `${SUPABASE_URL}/rest/v1/sellers?email=eq.${encodeURIComponent(email)}&select=*`,
        {
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
          }
        }
      );
      
      if (!response.ok) {
        throw new Error(`Failed to authenticate: ${response.status}`);
      }
      
      const sellers = await response.json();
      
      if (!sellers || sellers.length === 0) {
        errorDiv.textContent = '‚ùå Seller account not found';
        errorDiv.classList.remove('hidden');
        console.log('‚ùå No seller found with email:', email);
        return;
      }
      
      const seller = sellers[0];
      
      // Decode and verify password
      const storedPassword = atob(seller.password);
      if (storedPassword !== password) {
        errorDiv.textContent = '‚ùå Invalid password';
        errorDiv.classList.remove('hidden');
        console.log('‚ùå Password mismatch for seller:', seller.name);
        return;
      }
      
      // Check if seller is active
      if (!seller.is_active) {
        errorDiv.textContent = '‚ùå Your seller account has been deactivated';
        errorDiv.classList.remove('hidden');
        console.log('‚ùå Seller account is inactive:', seller.name);
        return;
      }
      
      // Login successful
      console.log('‚úì Seller authenticated:', seller.name);
      
      localStorage.setItem('sellerLoggedIn', 'true');
      localStorage.setItem('sellerId', seller.id);
      localStorage.setItem('referralCode', seller.referral_code);
      localStorage.setItem('sellerName', seller.name);
      localStorage.removeItem('adminLoggedIn');
      
      // Redirect to seller dashboard
      window.location.href = `seller-dashboard.html?seller_id=${seller.id}&referral=${seller.referral_code}`;
      
    } catch (error) {
      console.error('‚ùå Seller login error:', error);
      errorDiv.textContent = '‚ùå Login error: ' + error.message;
      errorDiv.classList.remove('hidden');
    }
  });
}

function initializeAdmin() {
  // Initialize admin panel functionality (from admin.js)
  console.log('‚úì Initializing admin panel...');
  setupListeners();
  switchTab('dashboard');
  updateDashboard();
}

function adminLogout() {
  if (confirm('Are you sure you want to logout?')) {
    localStorage.removeItem('adminLoggedIn');
    localStorage.removeItem('sellerLoggedIn');
    window.location.reload();
  }
}
</script>
</body>
</html>
